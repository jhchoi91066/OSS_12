from ast import Delete
from asyncio.windows_events import *
from asyncio.windows_events import NULL
from tkinter import *

global win
win = Tk()

win.title("Test")
win.option_add("*Fonts", "맑은고딕 25")
win.geometry("1280x800")

global canv
canv = Canvas(win, width = 1280, height = 800, background = 'white')
canv.pack(padx = 0, pady = 0)


class Point:            #점의 위치
    px = float()
    py = float()
    res = str()
    b = int()

    def __init__(self, x, y):
        self.px = x
        self.py = y
        self.res = None
        self.b = canv.create_oval(self.px - 4, self.py - 4, self.px + 4, self.py + 4, fill="black")

    def setPoint(self, x, y):
        self.px = x
        self.py = y
        canv.delete(self.b)
        self.b = canv.create_oval(self.px - 4, self.py - 4, self.px + 4, self.py + 4, fill="black")


    def setRes(self, c):
        self.res = c
        


global End_ps
End_ps = []         #끝 점들 모음.


class Start_P(Point):
    nextP = []
    line = []
    clk = 0


    def __init__(self, x, y):
        self.px = x
        self.py = y
        self.b = canv.create_oval(self.px - 4, self.py - 4, self.px + 4, self.py + 4, fill="black")
        
        canv.tag_bind(self.b, '<B1-Motion>', self.line_drawing)
        canv.tag_bind(self.b, '<ButtonRelease-1>', self.line_end)
        canv.tag_bind(self.b, '<Button-3>', self.del_all_line)


    def __del__(self):
        canv.delete(self.b)


    def setnextP(self, k):
        self.nextP.append(k)
        self.nextP[len(self.line)-1].setRes(self.res)


    def del_all_line(self, event):
        while(len(self.nextP) == 0):
            if(type(self.nextP[0]) == Start_P):
                self.nextP.del_all_line()
                c = self.nextP.pop(0)
                del(c)

            elif(type(self.nextP) == int):
                global End_ps
                End_ps[self.nextP[0]].setRes(None)
                del(self.nextP[0])

        for i in range (len(self.line)):
            canv.delete(self.line[0])
            del self.line[0]


    def line_drawing(self, event):
        if(self.clk == 1):
            canv.delete(self.line[-1])
            del self.line[-1]
        
        if(event.y <= self.py + 1 and event.y >= self.py -1):
            self.line.append(canv.create_line(self.px + 4, self.py, event.x, self.py, width = 5))
        elif(event.x <= self.px + 1 and event.x >= self.px -1):
            self.line.append(canv.create_line(self.px, self.py + 4, self.px, event.y, width = 5))
        elif(abs(event.y) - self.py <= abs(event.x) - self.px):
            self.line.append(canv.create_line(self.px + 4, self.py, event.x, self.py, event.x, event.y, width=5))
        elif(abs(event.y) - self.py >= abs(event.x) - self.px):
            self.line.append(canv.create_line(self.px, self.py + 4, self.px, event.y, event.x, event.y, width=5))

        self.clk = 1
        

    def line_end(self, event):
        global End_ps
        for k in range(len(End_ps)):
            i = End_ps[k]
            if(event.x <= i.px + 4 and event.x >= i.px -4 and event.y >=i.py - 4 and event.y <= i.py + 4):
                canv.delete(self.line[-1])
                del self.line[-1]
                self.line.append(canv.create_line(self.px, self.py, self.px, event.y, event.x, event.y, width=5))
                self.nextP.append(k)
                i.setRes(self.res)
                self.clk = 0
                break
        if(self.clk == 1):
            self.nextP.append(Start_P(event.x, event.y))
            self.nextP[-1].setRes(self.res)
            self.clk = 0



     
'''
class gate:
    loca = Point(None, None)
    res = str()
    Inp1 = End_P(None, None)      #가 점의 중간 위치
    Inp2 = End_P(None, None)
    Outp = Start_P(None, None)

    def __init__(self, x):      #x는 gate가 처음 왼쪽에 놓일 곳.
        self.loca = x
        res = "A 연산자 B or A' "

    def move(self, x):          # 게이트 이동 - 클릭후 이동시켜 main에 놓을때 사용
        self.loca = x

    def linked(self, y):





class AND_gate(gate):

    def __init__(self):
        self.loca = Point()

    

'''
a = Start_P(100, 100)

b = Point(500, 500)
End_ps.append(b)






win.mainloop()
